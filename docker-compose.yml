version: "3"
services:
  redis:
    image: redis:alpine
    container_name: redis
    restart: always
    command: [ "redis-server", "--appendonly", "yes", "--port", "${REDIS_PORT:-6379}" ]
    ports:
      - "${REDIS_PORT:-6379}:${REDIS_PORT:-6379}"
    healthcheck:
        test: [ "CMD", "redis-cli", "-p", "${REDIS_PORT:-6379}", "ping" ]
        interval: 60s
        timeout: 10s
        retries: 10
    logging:
        options:
            max-size: "50m"
            max-file: "10"
  tmp:
    image: busybox
    command: chmod -R 777 /tmp/redis
    volumes:
        - /tmp/redis/:/tmp/redis
  redis-socket:
    image: redis:alpine
    container_name: redis-socket
    restart: always
    command: [ "redis-server", "/etc/redis.conf" ]
    volumes:
        - /tmp/redis/:/tmp/redis
        - ./tests/redis.conf:/etc/redis.conf
    healthcheck:
        test: [ "CMD", "redis-cli", "ping" ]
        interval: 60s
        timeout: 10s
        retries: 10
    logging:
        options:
            max-size: "50m"
            max-file: "10"
